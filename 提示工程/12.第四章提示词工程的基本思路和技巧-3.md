### 第4章 提示工程的基本思路和技巧 
这个例子里面，我们看到在一般提示下，模型计算错误，而在思维链提示下，则给出了正确结果，还给出了推理的过程：“小哥每天送500个包裹，工作6天能送3000个，现每天送500 + 100 = 600个，送完3000个需5天。” 

![image](https://github.com/user-attachments/assets/5bdd0c4c-d748-419d-aafa-2adc26e462b9)


#### 标准提示 
**输入**

- 问题：4台播种机4天播种160亩地，照这样计算，5台播种机6天播种多少亩地？

  答案：5台播种机6天播种300亩地。

- 问题：快递小哥每天能送500个包裹，现为提升效率，小哥决定每天加班多送100个包裹，请问之前小哥工作6天的包裹量现在多久可以送完？ 

**输出**
- 答案：小哥需要6天送完。😔

#### 思维链提示 
**输入**

- 问题：4台播种机4天播种160亩地，照这样计算，5台播种机6天播种多少亩地？

  答案：4台播种机4天播种160亩地，故一台播种机一天播种10亩地，5台播种机6天播种300亩地。

- 问题：快递小哥每天能送500个包裹，现为提升效率，小哥决定每天加班多送100个包裹，请问之前小哥工作6天的包裹量现在多久可以送完？ 

**输出**

- 答案：小哥每天送500个包裹，工作6天能送3000个，现每天送500 + 100 = 600个，送完3000个需5天。😄

**图4 - 3 标准提示与思维链提示比较** 

#### （2）零样本思维链（zero - shot chain - of - thought） 

相较于手动思维链，这种方法更为简单，只需要在输入问题的末尾附加上“让我们一步一步地思考（Let’s think step by step）。”这几个词，就可以神奇地激发语言模型来自动生成一条思维链，如图4 - 4所示。 

#### 零样本思维链提示 
**输入**
- 问题：一个机器人一分钟能打100个字，照这样计算，两个机器人两天一共能打多少字？
  答案：让我们一步一步地思考。 

**输出**
- 一个机器人一分钟能打100个字，那么60分钟就能打60*100 = 6000个字。一天有24小时，所以一天就能打24*6000 = 144000个字。两个机器人同时打，那么一天就能打2*144000 = 288000个字。两天就能打2*288000 = 576000个字。所以，答案是两个机器人两天一共能打576000个字。 

![image](https://github.com/user-attachments/assets/63b32703-75e8-416c-9c8a-1c8708619d97)


**图4 - 4 零样本思维链的例子** 

#### （3）多模态思维链（multimodal chain - of - thought） 

在回答复杂的问题时，人类可以接受不同模态的信息，例如，同时处理语言，声音和图片，并理解其中的种种联系。随着对大模型的研究越来越多，思维链可以不再只局限于单一的语言模态，逐渐向多模态思维链发展。由Zhang等人于2023年提出的将文本和视觉相结合的多模态思维链中，模型分两阶段完成任务。首先模型接受了自然语言和文本的双重信息生成解决问题的逻辑（rationale generation），随后将其作为输入的一部分让模型给出答案。实验发现在多模态任务中，利用这样的一个两步思维链方法，能够让模型有效利用输入图像的信息，减少幻觉的出现。 

### 4.3.2 自洽性 
自洽性（self - consistency）是在思维链之上更进一步，它不只是生成一个思维链，而是生成多个思维链，然后以多数答案为最终答案。自洽性由Wang等人于2022年提出，利用了这样一个直观假设，即一个复杂的推理问题通常有多种不同的思考方式，但只有一个正确的答案，而多次推理结果一致的更可能是正确答案。其基本思路如图4 - 5所示。 

![image](https://github.com/user-attachments/assets/d6779c63-2f52-4a41-b6ca-5a6829363dcd)


**问题**：3箱苹果重45千克。一箱梨比一箱苹果多5千克，3箱梨重多少千克？

**答案**：设一箱苹果重x千克，那么一箱梨重x + 5千克。根据题意，有3x = 45，解得x = 15。所以一箱梨重15 + 5 = 20千克，3箱梨重3×20 = 60千克。 



**问题**：甲乙二人从两地同时相对而行，经过4小时，在距离中点4千米处相遇。甲比乙速度快，甲每小时比乙快多少千米？ 

**答案**：” 

现在，我们将使用这一提示来生成多个不同的思路。 

1）设甲的速度为x千米/时，乙的速度为y千米/时，两地的距离为d千米。根据题意，有甲走的路程 + 乙走的路程 = d，4x + 4y = d，相遇点距离中点4千米，甲走的路程 - 乙走的路程 = 8，4x - 4y = 8，解这个方程组，得x = y + 2，所以甲每小时比乙快2千米。 

2）设甲乙二人的速度分别为v和u千米/小时，那么甲比乙速度快v - u千米/小时。设两地相距d千米，那么经过4小时，甲走了4v千米，乙走了4u千米。由于他们在距离中点4千米处相遇，所以有(4v + 4u)/2 = d/2 - 4解得d = 8v + 8u + 16。另一方面，由于他们从两地同时相对而行，所以有(v + u)/d = 1/t，其中t是他们相遇的时间（单位为小时）。将d的值代入这个方程，得到(v + u)/(8v + 8u + 16) = 1/t化简得t = (8 + t)/(v - u)将t = 4代入这个方程，解得v - u = 0.5。所以甲每小时比乙快0.5千米。 

3）设甲乙两地相距d千米，甲的速度为v千米/小时，乙的速度为u千米/小时。根据题意，有甲在4小时内走过的路程 + 乙在4小时内走过的路程 = d，v×4 + u×4 = d甲在4小时内走过的路程 - 乙在4小时内走过的路程 = 8，v×4 - u×4 = 8，联立这两个方程，可以消去d，得到(v + u)×4 = d，(v - u)×4 = 8相加得2v×4 = d + 8，v = (d + 8)/(2×4)，v = (d + 8)/8，相减得，2u×4 = d - 8，u = (d - 8)/(2×4)，u = (d - 8)/8，所以甲比乙速度快，差为v - u = ((d + 8)/8) - ((d - 8)/8)，v - u = (16/8)，v - u = 2，即甲每小时比乙快2千米。 



根据第一个思路得到答案：甲每小时比乙快2千米；根据第二个思路得到答案：甲每小时比乙快0.5千米；根据第三个思路得到答案：甲每小时比乙快2千米。通过生成多条思路，并取最常出现的答案（甲每小时比乙快2千米），用户可以得到更一致正确的答案。 

### 4.3.3 由少到多 
人在面对复杂问题时往往难以一步到位给出正确答案，我们观察到语言模型也是这样。当用户给大型语言模型较难的输入时，它直接给出正确答案的概率并不高。由少到多（least to more）提示法就是面对无法一步到位解决复杂问题时采用的一种技巧，由Denny Zhou等人提出。利用它的核心思想，我们首先让大模型将问题分解为子问题，然后逐一解决每个子问题直到得出最终答案。图4 - 6展示了用该方法来进行分步提示的思路。 

![image](https://github.com/user-attachments/assets/c9513895-943e-4b29-ba3f-11a03b2b2ac6)


**第一步：将问题分解为子问题**

- **提示**：问题F
- **语言模型**：为了方便问题F，可以把问题F分解为：子问题1、子问题2…… 

**第二步：循序渐进解决问题**

- **提示**：问题：子问题1
- **语言模型**：答案：子问题1的答案
- **提示**：问题：子问题1答案：子问题1的答案 问题：子问题2
- **语言模型**：答案：子问题2的答案
- **提示**：问题：子问题1答案：子问题1的答案 问题：子问题2答案：子问题2的答案 …… 问题：问题F
- **语言模型**：答案：问题F的答案 

**图4 - 6 由少到多提示法的思路** 

下面用一个稍微复杂一点的相遇问题来解释这个方法。 

**问题**：一列火车和一列慢车，同时分别从甲乙两地相对开出。快车每小时行75千米，慢车每小时行65千米，相遇时快车比慢车多行了40千米，甲乙两地相距多少千米？ 

在GPT - 4上用常规的提示得到答案：甲乙两地相距640千米。答案有误。 

尝试将它分解为子问题，得到以下可能的分解： 
- 子问题1：快车和慢车相遇时，它们各自行了多少时间？
- 子问题2：快车和慢车相遇时，它们各自行了多少千米？
- 子问题3：甲乙两地的距离等于快车和慢车相遇时的总路程，总路程是多少？ 


首先将子问题1带入原始提示。 

**问题**：一列火车和一列慢车，同时分别从甲乙两地相对开出。快车每小时行75千米，慢车每小时行65千米，相遇时快车比慢车多行了40千米，甲乙两地相距多少千米？首先回答快车和慢车相遇时，它们各自行了多少时间？ 

**得到答案**：根据题意，快车和慢车相遇时，它们的行驶距离之差为40千米，即：75t - 65t = 40，其中，t为它们各自行驶的时间（单位为小时），解得：t = 4。所以快车和慢车相遇时，它们各自行了4小时。 

其次回答甲乙两地相距多少千米？ 

根据题意，甲乙两地相距的距离等于快车和慢车相遇时，它们的行驶距离之和，即：75t + 65t = d，其中，d为甲乙两地相距的距离（单位为千米），代入已知的t = 4，得到：d = 560。所以甲乙两地相距560千米。答案正确。 

仅仅通过解决第一个子问题，我们就能够解决整个问题。如果模型没有立即返回答案，还可以继续解决下一个子问题，直到它返回答案为止。 



### 4.3.4 生成知识提示法 

生成知识提示法（generated knowledge prompting）由Liu等人提出。我们在做决策时通常需要预先搜集一些相关资料，因为额外的知识总能帮助做出更好的决定。生成知识提示就是从这点出发，在生成最终回答之前，要求语言模型先生成与问题有关的背景信息，然后在回答问题时将知识作为额外的输入提供。这个方法非常有优势，因为它不依赖外接数据库来提供知识，也不要求针对任务作有监督的学习。这利用的是模型自身已经习得的知识。 

例如，你想写一段有关新能源的小论文。在让模型写论文之前，可以让它生成一些关于新能源的优缺点。这将有助于模型写出更有信息量的论文。 

**输入提示**：列出新能源的三个优缺点，用它们写一段关于新能源的小论文。 

**输出结果**： 

新能源，如太阳能、风能、生物质能等，是指利用可再生资源或低碳技术产生的电力或热力。新能源相对于传统的化石燃料或核能，有着一些明显的优缺点。 

- **优点**：
    - 新能源的最大优势是环保。新能源不会排放温室气体或有毒物质，不会造成空气污染或气候变化，也不会产生危险的核废料。新能源有助于保护自然环境和人类健康。
    - 新能源的另一个优势是可持续。新能源利用的资源是不断更新或循环的，如太阳光、风力、水力、潮汐力、地热力等。这些资源不会像化石燃料那样耗尽，也不受地域或政治的限制。新能源有助于提高能源安全和多元化。 
    - 新能源的还有一个优势是创新。新能源涉及了许多先进和高科技的领域，如光伏、风机、电池、燃料电池等。这些领域需要不断地进行研发和改进，以提高效率和降低成本。新能源有助于推动科技进步和经济发展。 
- **缺点**： 
    - 新能源的最大缺点是成本高。虽然一些新型技术已经取得了突破性的进展，并且政府也给予了一定程度的补贴和支持，但是与化石燃料相比，仍然需要投入更多的资金和人力来建设和运行新型设施，并且面临更多的风险和挑战。 
    - 新能源的另一个缺点是不稳定。由于许多可再生资源依赖于自然条件和季节变化，如日照、风速、降水等，因此它们在时间上和空间上都存在波动性和随机性。这就需要建立适当的储存系统或调节机制来平衡供需关系，并且与传统电网相协调。 
    - 新能源商品一个缺点是影响环境。虽然从整体上看，新能源商品减少了温室气体排放，但在某些情况下，它们也可能对局部生态系统造成干扰或损害。例如，大规模建设水电站可能导致河流干涸、水位下降、生物多样性减少；大面积种植植物可能占用耕地，消耗水分，影响土壤肥力；大量安装太阳板或风车可能改变景观美观度，影响鸟类迁徙或其他动物活动。 

综上所述，新能源商品既有利又有弊，在推广和使用中应该充分考虑其影响因素，并寻求合理平衡。同时应该加强对公众意识形态教育、服务区域、促进社会对新能源发展支持，只有这样才可以实现向低碳经济转型之路。 


也可以使用双重提示分成两个阶段生成答案，先列出新能源的三个优缺点，再根据生成的优缺点，用它们写一段关于新能源的小论文。 

**阶段1输入提示**：列出新能源的三个优缺点。 

**阶段1输出结果**： 

- **新能源的优点**：
  
    - 新能源可以减少对传统化石能源的依赖，降低能源进口和供应的风险，提高能源安全性； 
    - 新能源可以减少温室气体和污染物的排放，改善环境质量，缓解全球变暖和气候变化的压力； 
    - 新能源可以创造新的就业机会和产业链，促进科技创新和经济发展，提高社会福祉。 
- **新能源的缺点**：
  
    - 新能源的成本相对较高，需要大量的政策支持和投资扶持，可能影响市场竞争力和效率； 
    - 新能源的稳定性和可靠性相对较低，受自然条件和季节变化的影响较大，需要配合储能设备和电网调度来保证供需平衡； 
    - 新能源的开发利用可能存在一些技术障碍和社会阻力，如资源评估、并网接入、空间规划、环境影响、公众意识等。 

**阶段2输入提示**： 

- 新能源的优点：
    - 新能源可以减少对传统化石能源的依赖，降低能源进口和供应的风险，提高能源安全性； 
    - 新能源可以减少温室气体和污染物的排放，改善环境质量，缓解全球变暖和气候变化的压力； 
    - 新能源可以创造新的就业机会和产业链，促进科技创新和经济发展，提高社会福祉。 
- 新能源的缺点： 
    - 新能源的成本相对较高，需要大量的政策支持和投资扶持，可能影响市场竞争力和效率； 
    - 新能源的稳定性和可靠性相对较低，受自然条件和季节变化的影响较大，需要配合储能设备和电网调度来保证供需平衡； 
    - 新能源的开发利用可能存在一些技术障碍和社会阻力，如资源评估、并网接入、空间规划、环境影响、公众意识等。 


用上述优缺点写一段关于新能源的小论文。 

**阶段2输出结果**： 

新能源是指利用可再生资源或创新技术产生的能源，如太阳能、风能、生物质能、地热能、核聚变能等。新能源具有多方面的优点，可以提高我国的能源安全性、改善环境质量、促进经济社会发展。因此，发展新能源是我国应对能源危机和气候变化的重要战略。 

然而，新能源也面临着一些缺点和挑战，需要克服成本高、稳定性差、技术不成熟、社会不认可等问题。为了推动新能源的健康发展，需要加强政策引导和资金支持，建立合理的价格机制和市场体系，增加研发投入和人才培养，完善储能和电网设施，加强环境评估和空间规划，提高公众意识和参与度。总之，新能源是我国未来可持续发展的重要方向之一，具有巨大的潜力和价值。我们应该充分利用自身优势，抓住机遇，积极应对挑战，推进新能源产业的转型升级。 


### 4.3.5 自动提示生成 

前文提到大语言模型自身可以作为提示工程的有效工具。最简单的方式是直接让模型生成一些候选的提示指令，然后人为选取。因为，我们有时对指令的表述方式并不是最高效的，采用模型自己生成的指令结果可能更胜一筹。但是对于模型生成的候选指令，我们仍然需要逐一评估。同时，在利用评估的结果来改进指令这一步，仍然是依赖人工评测和试错。 

对此，Zhou等人提出了一种使用大语言模型来自动生成和选择指令的算法框架，并命名为“自动提示工程师（automatic prompt engineer）”。在生成候选指令的阶段，该方法通过给语言模型展示若干个目标任务的输入和预期输出来帮助



语言模型准确理解任务。在评估阶段，对候选指令在小数据集上进行测试并评估该指令的表现，获得各自的得分。此后，选取其中得分较高的指令，来利用大语言模型生成更多类似的高质量的指令，充实到候选指令集中，进行后续迭代。可以看到，该框架的基本思想是通过模拟人类提示工程师工作中的指令撰写、效果评估和后续改进的过程，以达到自动化生产高质量提示的目的。在实际使用中，这一方法的实施十分耗费资源，大家可以酌情选用。也可以考虑与人工调试相结合的方式来减小搜索空间，采用其算法思想来优化部分提示迭代过程等。 
