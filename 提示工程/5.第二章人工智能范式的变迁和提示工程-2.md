### 提示工程：方法、技巧与行业应用

语言模型提供提示时，它们首先会从输入中提取关键信息，并根据其在训练数据中观察到的相关模式来生成合适的回应。这些模型还能够理解和处理多种任务，如回答问题、写作、翻译等。

当然，大语言模型输出的质量和准确性可能会受到提示质量、模型的训练数据和模型本身的限制等因素的影响。为了获得更好的结果，用户可能需要尝试不同的提示策略，如提供更明确的指示、使用不同的表述等。这些也就是提示学习所要研究的内容。

### 2. 提示学习的步骤

下面介绍提示学习的步骤。

设原始输入的文本为x。

第一步，为了构造提示，需要设计一个带有待填空的模板，其中的空分为两类：一类是[X]的空，另一类是[Z]的空。

[X]的空是预留给最终用户的原始输入的，之后原始输入x会填入到[X]中去。

Z是指构建的一个答案空间。这个空间是预留给模型填充答案的，并不会预先填充内容，只是给它留出一个[Z]空来等待模型的填充。通过提示空间中的提示信息，模型可以学习到更多的知识和特征，并提高在文本理解任务中的表现。

第二步，将原始输入x填入[X]空。将填写结果记为x'。x'中的[Z]空被留待模型填充。同时，也会提供一些提示信息z，以帮助模型更好地学习和理解文本。通过不断地填空和理解提示信息，模型可以逐渐提高在文本理解任务中的表现。

第三步，将x'送入预训练语言模型进行推理。预训练语言模型能够根据x'生成对应的输出z'。在z'中，对应[Z]空的位置的内容即为模型从提示信息中学习到的知识和特征。

第四步，可以将z'中对应[Z]处的信息提取出来，作为模型训练和优化的依据。

通过这样的方式，提示学习可以帮助模型更好地学习和理解文本，适用于各种自然语言处理任务，如语言生成、文本分类、问答系统等。



下面通过一个例子来理解一下这个过程。

假设想要通过提示学习获得一个电影推荐系统，帮助用户找到自己喜欢的电影。可以设计如下一个模板和对应的提示信息。

![image](https://github.com/user-attachments/assets/d5785e05-b1ea-4f5e-b657-891e64095766)


模板：[X]这部电影[Z]。

将用户输入带入[X]，例如用户输入是：“我喜欢这部电影。”，带入模板后获得的x'为：“我喜欢这部电影。这部电影[Z]。” 如图2-7这样。

### 提示模板示例

提示模板：[X]这部电影[Z]

生成提示(x')：我喜欢这部电影。这部电影[Z]

将x'输入到预训练语言模型中，模型需要通过填空和理解提示信息来预测电影的评价。可能得到的输出是：“我喜欢这部电影。这部电影好看。”或者“我喜欢这部电影。这部电影优秀。”

理论上来说，模型应该会预测出优秀、好看或者还行等正面的评价，而不应该输出不行或者太差劲的评价，否则就意味着模型存在一定的问题。为了更好地衡量模型的性能，可以将模型的输出进行一层映射，将优秀和好看映射为正向的（positive），将还行映射为中性的（neutral），将不行或者太差劲映射为负向的（negative）。这样，就可以根据模型的输出结果判断其是否为一个正向、中性或负向的评价。

如果模型输出的结果符合预期，那么说明模型具有一定的性能和预测能力。而如果模型输出的结果偏向于负向的评价，那么说明模型可能存在一定的问题，需要进一步调整和优化。

实际上，我们已经利用提示学习完成了一项文本分类的任务：Z对应的结果是一系列类别标签。

提示学习当然不仅仅只能做分类，它还可以完成许多任务，如标记和问答。例如，当人们向ChatGPT输入“世界上最高的山是哪里”，它会输出“珠穆朗玛峰”作为答案。这也可以看作一种提示学习的方式。



### 2.2.2 提示学习的研究领域


提示学习分为多个研究领域，下面介绍其中主要的几个。

#### 1. 大语言模型的选择

大语言模型本身的网络拓扑结构可以对迁移学习和提示学习的模板构建产生重要影响。这是因为大语言模型的网络拓扑结构决定了它对输入数据进行特征提取和表示的能力。

具体来说，如果大语言模型的网络拓扑结构与目标任务的输入数据类型和特征类型相匹配，则可以使用大语言模型的底层特征提取能力，从而加速目标任务的学习。提示学习的第一步就是构造模板，选择不同的大语言模型会直接影响模板的设计。

例如，BERT是一种双向预测模型，目标token可以被左边和右边的token同时预测，那么在这种情况下，设计的模板的[Z]就可以放在中间。而GPT是一种单向预测模型，它是通过顺序预测来生成输出的。因此，在设计GPT的模板时，应该把[Z]模板放在最后面。我们必须根据大语言模型的特点来确定模板，而不能随便设计。

#### 2. 手动提示工程

提示工程是提示学习的一个重要部分。它涉及制定和设计用于指导大语言模型的模板。其核心在于通过构建适当的提示来激发大语言模型的潜力。提示既可以由相关人员手动生成，还可以利用计算机技术自动生成。

手动生成提示的方法简单、直接，具备探索性，而且可以立即获得结果并经过人工评估。在当前这个提示工程的发展阶段，各行各业的专业人员都可以利用自己的领域知识生成自然语言的提示词来提示大语言模型。因此，很多时候，人们说“提示工程”其实默认指的是手动提示工程。

手动提示工程的原则非常重要，最主要有以下两点。

- 多次迭代：尝试使用不同的词汇或句式，反复尝试，直到找到最优的提示。

- 渐进提示：先从最主要的单一指令或问题开始，逐步提供更多的信息或更具体的问题，直到得到满意的答案。

无论什么样的方法和技巧，都无法脱离上述原则，由此可见，手动提示工程的核心在于尝试和探索。

手动提示工程发展非常迅速，各种各样的方法层出不穷。除了针对大语言模型的特点和性能构建提示格式和用词外，还有一些通用的技巧，可供借鉴。这些技巧包括但不限于以下几种。

- 显式指示：在提示中明确指出你想要的回答格式或风格，例如：“以科普文章的风格润色下面内容……”

- 角色扮演：模拟一个场景，让模型扮演某个角色，例如：“假设你是一位大学二年级的计算机老师，请为你的学生们设计一张数据结构课程的期末考卷……”

- 对比策略：要求模型提供对比信息，例如：“请比较Python和Java两种编程语言的主要区别”。

- 设置输出限制：明确指出回答的长度或形式，例如：“请写一段200字以内的短文，描述……”

- 结构化输出：指明提示输出的数据结构。

- 数据源限定：指出希望模型依据某些来源或数据来回答。

- 上下文参考：为问题提供背景信息或上下文，帮助模型更准确地理解和回答。

一个很重要的提示构建思想是思维链。这是一个新兴的概念，尽管提出时间并不长，但已经在众多科技媒体上广泛传播。

所谓思维链，其实也是一种提示的方法。假设你遇到了一个难题，当你将这个问题直接输入给语言模型时，未能得到正确的答案，你可以尝试对问题进行链式重新构建：首先，我们需要给出一个问题的正确答案，然后将答案与原始问题一同呈现；其次，我们再提出一个与之类似的问题；最后，将前面的问题、答案和新问题一起输入给语言模型，这样就有可能得到正确的答案了。

这个过程就像是教导小学生解决应用题。当他们遇到难题时，你需要先向他们讲解解题方法，并带领他们完成一道类似的题目，让他们掌握解题过程。然后，再给他们出一道类似的题目，让他们独立完成。这样，他们很可能就能成功解答问题了。这就是一个简单的思维链示例。

![image](https://github.com/user-attachments/assets/1c2e160b-a1d5-4b29-9fb9-c66109660ef3)


### 思维链样例

#### 模型输入
- **标准提示**：
  - 问：小明有5颗草莓，他又买了2盒草莓，每盒6颗，请问小明现在一共有几颗草莓？
  - 答：小明一共有17颗草莓。
  - 问：小花幼儿园的食堂原本有33个猕猴桃，今天下午给小朋友制作水果沙拉用掉了20个，然后又买了17个，现在食堂还有多少个猕猴桃？
- **思维链提示**：
  - 问：小明有5颗草莓，他又买了2盒草莓，每盒6颗，请问小明现在一共有几颗草莓？
  - 答：小明本来有5颗草莓，又买了2盒，每盒6颗草莓，因此5 + 2×6 = 17，一共有17颗草莓。
  - 问：小花幼儿园的食堂原本有33个猕猴桃，今天下午给小朋友制作水果沙拉用掉了20个，然后又买了17个，现在食堂还有多少个猕猴桃？
#### 模型输出
- **标准提示**：答：食堂现在有25个猕猴桃。×
- **思维链提示**：答：小花幼儿园食堂原本有33个，用掉20个后还剩下13个，然后又买了17个，所以一共有13个 + 17个 = 30个猕猴桃。食堂现在还有30个猕猴桃。√


还有更复杂的思维链，当直接给出答案还不能“教会”语言模型时，可以将复杂的问题拆分为多个简单问题，先将第一个小问题输入给语言模型，很可能就能够获得正确的答案，得到正确答案之后，再把第一个小问题、它的正确答案和下一个小问题一起输入给模型，得到第二个小问题的答案……如此重复，逐步解决完整的问题。这种方法注重每个子问题之间的关联和依赖关系，其中的每个子问题都被视为一条思维链的一部分，而解决整个问题就是将这些思维链连接在一起。

对思维链的研究还处在相对较早的阶段，读者有兴趣可以持续关注。

手动提示工程毕竟是一个耗时且复杂的工作，对于大规模应用，可能需要使用更高效的自动化提示工程。

#### 3. 自动化提示工程

所谓自动化提示工程，顾名思义，就是使用计算机自动生成提示。它使用机器学习技术和其他自动化工具，使得提示生成过程更加高效和快速。其间可以使用大量的数据和预先训练的模型，以生成有效的提示。它还可以自动评估提示的性能，并进行自我调整，以提高提示的效果。

自动化提示工程又可以细分成许多具体的方法，例如：使用机器学习或其他算法对大量用户的真实输入进行分析，以提取有效提示；利用自动化技术改写现有提示，以使其更适合大语言模型的生成；利用人工智能模型生成提示等。使用模型生成的评分器对提示的质量进行评估，以确保提示的有效性，也属于此范畴。

除了自动生成自然语言的提示词，自动化提示工程还可以生成并使用文本嵌入（text embedding）形式构建的提示。文本嵌入形式，可以与大语言模型的内部表示相匹配。

在文本嵌入空间中，自然语言词汇和短语被映射为向量，每一个词汇或短语都可以表示为该空间中的一个点。由于嵌入空间是无限的，因此可以使用文本嵌入空间中的任何一个向量来构建提示。这种方法不仅能够表达自然语言中的含义，而且还能够整合多个含义。这使得连续提示在某些情况下能够表达一些自然语言无法很直接表达的含义。它为模型生成更加准确、灵活和富有创造性的文本提供了可能性。

这一做法的优点显而易见：首先是效率高，文本嵌入形式的提示比文本形式的提示更容易处理，因为它们可以直接在计算机内存中存储和进行计算；其次，因为具有统一的形式，方便统一处理，避免了文本形式的提示存在的格式问题；然后，它们具有可解释的数字特征，更容易分析和解释；最后，多数大语言模型通常使用文本嵌入作为输入，因此使用连续的提示可以更容易地与这些模型集成。

常见的连续提示技术包括前缀调整（prefix tuning）和硬 - 软提示混合调整（hard - soft prompt hybrid tuning）。

前缀调整的核心思想是优化一个固定长度的可训练前缀，然后用这个优化后的前缀来指导模型生成特定类型的内容。这种方法可以用于许多自然语言处理任务，如机器翻译、自动摘要、语言生成等。

前缀调整的过程大致如下。

1）选择一个预训练语言模型，例如GPT - 2、GPT - 3或其他任何大语言模型，然后固定预训练模型的参数，使模型参数在后续的过程中保持不变。

2）为特定任务初始化一个固定长度的前缀，这个前缀的每一个元素都是模型的一个输入token。这个前缀是可训练的，也就是说，它的值会在训练过程中被更新和优化。

3）对前缀进行训练——将前缀和目标任务的训练数据输入给模型，生成输出。然后将输出与期望输出进行比较，计算损失，使用梯度下降或其他优化算法来更新前缀的参数。

4）验证前缀的性能，并根据需要进行多次迭代。

5）完成训练后，将优化后的前缀与新输入一起送入模型，这样可以得到目标任务的相关输出。由此可见，前缀调整是一个模型训练的过程，但因为调整的不是模型本身的参数，而是输入的前缀的参数，因此只需要一个相当小的参数集，相较于传统微调模型更加高效，且避免了大量参数的过拟合。这使得前缀调整在资源有限的场景中尤为有用。

很多时候，在进行前缀调整时需要加入一些约束条件，这些约束条件可能是硬性的，也就是必须满足的，例如生成的文本必须包含某些特定的关键词或短语等；也可能是软性的，或者说是弹性的，也就是在必要时可放宽的，例如文本应当流畅易读等。由此衍生出了一种高级的前缀调整技巧——硬 - 软提示混合调整，即通过在输入前缀的基础上生成符合约束的文本，来进行前缀调整。它的具体流程如下。

1）选择一个预训练的语言模型，并固定其参数。

2）定义软硬约束，并分配权重，以平衡两类约束的影响。

3）在训练前缀的过程中融合约束——这一步与前缀调整类似，但在计算损失函数时，除了常规的任务损失外，还加入了硬约束和软约束的损失。

4）验证前缀的性能，根据模型对硬约束和软约束的满足程度进行调整，并进行多轮迭代。

5）完成训练后，将优化后的前缀与新输入一起送入模型，可以得到满足硬约束和软约束的目标输出。

这种方法让用户更好地控制模型的生成过程，因为他们可以精确地指定模型的输出应该满足哪些条件，同时还保留了模型的创造性和流畅性。

#### 4. 多重提示学习

很多时候，单独完成一个任务可能不够高效。将多个提示模型的任务融合，往往能够大大提升效率。这样的策略被普遍称作“多重提示学习”，它让模型在处理多个任务时分享某些信息，从而从其他任务中汲取有益的知识。目前，多重提示学习主要展开在四个方向：集成、增强、合成和分解。

- **提示集成**：这一策略旨在将众多提示整合融为一体，生成一个包含多重任务的提示，输入给大语言模型处理。这种做法能有效降低成本，毕竟推理是一个资源消耗较大的环节。

- **提示增强**：指为模型提供更多背景信息，以便让其更精准地回答问题。例如，当遇到一道数学题时，增强提示可以通过附上相似的例题来协助模型。在回答“5×9 = 几”这类问题时，可以提供“1×9 = 9”和“3×7 = 21”等基础信息，以增强模型的判断力。 

- **提示合成**：这一做法是将众多提示模板融合成一个模板，然后用多个任务的信息进行填充后作为一条输入送人大语言模型。与提示集成不同，提示合成只合并模板，而不是输入。这意味着模型可以在单次推理中同时回答多个问题，从而达到效率最大化。 

- **提示分解**：有合成就有分解，分解的目标是将一个复杂的模板拆解为多个简洁的小模板，让模型更为轻松地捕捉问题的核心。这种方式可以减轻模型的计算压力，确保输出更为精确。

多重提示学习就像一个工具箱，提供多种策略来优化模型的性能和效率。

#### 5. 答案空间设计

与提示工程相对的是答案工程（Answering Engineering），其关注的是如何生成、改进和优化机器为用户提供的答案。它又分为多个子领域，其中非常重要的一个子领域就是答案空间设计。

回顾提示学习的完整流程，其中一个关键步骤是将模型生成的文本映射到一个合适的答案空间，以便得到最终答案——模型生成的文本通常基于预先设定的模板和约束条件，在模型生成文本之后，还需要对其进行处理，将其映射到适当的答案空间。

答案空间是否合适，则直接关系到模型的准确性和可靠性。一个优秀的答案空间应当具备覆盖所有可能答案的能力，并能够协助模型准确地识别和映射答案。

关于答案空间设计，需要关注如下这些要点。

首先，答案空间设计需要确定答案的范围和界限。至少，我们需要根据应用场景来确定要设计的是有限答案空间，还是无限的答案空间。例如，任务需要回答某特定领域中的几个确定的答案，那么有限答案空间就是合适；但如果要生成长篇文章或故事，就需要无限答案空间了。

其次，设计时需要确定答案的粒度，是选择具体的单词、短语还是整句作为答案。例如，在文本摘要任务中，答案可能是一整段文字；而在填空题中，答案可能仅是一个词或短语。

再次，在某些场景下，答案空间应该能够捕获各种各样的答案，确保系统具有足够的灵活性来



回应多种情境。还有一些情况下，答案空间可能需要随着时间或上下文的变化而动态调整。这使得答案空间的设计需要用到多种不同行业、专业的领域知识，以及诸如机器学习、数据挖掘等多种技术手段。

最后，答案空间中的每一个答案都应该是高质量的，这可能需要通过人工审查或自动化工具来确保。

总之，设计出有助于任务目标完成的答案空间，是非常关键的。

#### 6. 答案空间搜索

仅仅设计、构建答案空间显示是不够的，答案空间存在的价值是让用户找到答案，因此如何有效地在答案空间中进行搜索，也是答案工程的重要分支。

当答案空间是离散、有限的时，可以通过人为定义某些约束条件，来搜索出满足条件的最优答案。这种答案搜索方法简单直接，易于应用，适用诸如多项选择题、问题回答、语言翻译等任务。实际操作中又可以分为答案改写，标签分解等多种做法。

答案改写是指为了满足特定的需求或者优化答案的质量，改写模型生成的答案，使其更符合用户的查询或更易于用户理解。这种技术的目标是提供更准确、更直接、更自然或更人性化的答案。具体做法包括：同义词替换、句子重组、句子裁剪、句子插入等。通常依赖深度学习、规则系统等自然语言处理技术来实现。

答案改写的应用场景包括：语言简化、标准化答案（对从不同来源获得的答案进行统一和标准化）、个性化答案（基于用户的历史行为或其他背景信息，为特定用户改写答案）、调整语法和语言风格等。

标签分解是指在分类任务中，将模糊或重叠的标签分解为更细致和明确的标签。例如，如果原始标签中有“科技”和“互联网”，但是“互联网”实际上是“科技”的一个子类，那么可能需要手动或自动地将其分解，将“科技”分解为“IT科技”和其他科技，并将“IT科技”进一步分解为“互联网”和“软件”等。通过这样的处理，可以使得分类任务中的标签更加具体和明确，有助于提高分类模型的准确性和稳健性。同时，这种方法还可以帮助人们更好地理解数据集的结构和特点，为后续的数据分析和挖掘提供有力支持。 
